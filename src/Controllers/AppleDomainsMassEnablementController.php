<?php

declare(strict_types=1);

/*
 * Payrix
 *
 * This file was automatically generated by Worldpay.
 */

namespace PayrixLib\Controllers;

use Core\Request\Parameters\BodyParam;
use Core\Request\Parameters\FormParam;
use Core\Request\Parameters\HeaderParam;
use Core\Request\Parameters\TemplateParam;
use Core\Response\Types\ErrorType;
use CoreInterfaces\Core\Request\RequestMethod;
use PayrixLib\Exceptions\ApiException;
use PayrixLib\Exceptions\ErrorFourHundredException;
use PayrixLib\Models\AppleDomainsMassEnablementCsvResponseResult;
use PayrixLib\Models\AppleDomainsMassEnablementForMerchantList;
use PayrixLib\Models\ApplePayForMerchantListPostRequest;
use PayrixLib\Models\UpdateApplePayDomainPostRequest;
use PayrixLib\Models\UpdateApplePayDomainResponseResult;
use PayrixLib\Utils\FileWrapper;

class AppleDomainsMassEnablementController extends BaseController
{
    /**
     * "Registers Apple Pay domains for multiple merchants using a CSV file. The uploaded CSV must include
     * at least two columns: `"domain"` and `"merchant_id"`. All other columns are ignored. The file is
     * parsed using the header row, and any data rows with missing or extra columns are also rejected.
     *
     * For each merchant-domain pair, the system creates an `appleDomains` record. Domains not already
     * registered are marked as `registering`, and asynchronous processing begins. If verification succeeds,
     * the status updates to `registered`. If verification fails, the status changes to
     * `failed_registration`, with an `errorNote` explaining the reason.
     *
     * This endpoint is idempotent for previously registered domains, allowing repeated submissions without
     * adverse effects. You can resubmit the same CSV to retry failed registrations after resolving any
     * issues.
     *
     * Upload the CSV file as a form-data field named files. All domains must be fully qualified domain
     * names (FQDNs) and must host the Apple Pay verification file at:
     * https://{merchantDomain}/.well-known/apple-developer-merchantid-domain-association
     *
     *
     * @param string $id The Payrix Pro Entity ID for the Partner initiating domain verification for
     *        one or more Merchants.
     * @param FileWrapper $files The `multipart/form-data` field used to upload the CSV file
     *        containing merchant-domain pairs for Apple Pay domain verification.
     *        The CSV file must include a header row with at least two columns: `"domain"` and
     *        `"merchant_id"`.
     * @param string|null $token A single-use, limited authentication layer in addition to an API
     *        Key or Session Key to authorize sensitive operations. <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/auth-tokens" target="_blank">Auth Tokens</a> add
     *        security by requiring one-time approval for specific actions.
     * @param string|null $requestToken A custom, one-time identifier for any API request (GET, PUT,
     *        POST, or DELETE). Blocks future requests with the same token for 48 hours, ensuring
     *        only the first request is processed. Valid values can contain 1-100 alphanumeric and
     *        special characters. See <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/request-tokens" target="_blank">Request Tokens</a>
     *        for more information.
     *
     * @return AppleDomainsMassEnablementCsvResponseResult Response from the API call
     *
     * @throws ApiException Thrown if API call fails
     */
    public function postApplePayForCsv(
        string $id,
        FileWrapper $files,
        ?string $token = null,
        ?string $requestToken = null
    ): AppleDomainsMassEnablementCsvResponseResult {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/entities/{id}/enableApplePayForCsv')
            ->auth('apiKey', 'sessionKey', 'txnSessionKey')
            ->parameters(
                TemplateParam::init('id', $id),
                HeaderParam::init(
                    'Content-Type',
                    'multipart/form-data; boundary=<calculated when request is sent>'
                ),
                FormParam::init('files', $files),
                HeaderParam::init('token', $token),
                HeaderParam::init('request-token', $requestToken)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn('400', ErrorType::init('Error', ErrorFourHundredException::class))
            ->type(AppleDomainsMassEnablementCsvResponseResult::class);

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Registers Apple Pay domains for a list of merchants using a JSON request body. For each merchant-
     * domain pair, the system creates an `appleDomains` record. Domains not already registered update
     * their status to `registering`, and asynchronous verification begins. If verification succeeds, the
     * status updates to `registered`. If verification fails, the status changes to `failed_registration`,
     * with an `errorNote` explaining the reason.
     *
     * This endpoint is idempotent, allowing repeated submissions of the same request body without adverse
     * effects. Only failed registrations are retried.
     *
     * All domains must be fully qualified domain names (FQDNs) and must host the Apple Pay verification
     * file at:
     * https://{merchantDomain}/.well-known/apple-developer-merchantid-domain-association
     *
     *
     * @param string $id The Payrix Pro Entity ID for the Partner initiating domain verification for
     *        one or more Merchants.
     * @param ApplePayForMerchantListPostRequest $body
     * @param string|null $requestToken A custom, one-time identifier for any API request (GET, PUT,
     *        POST, or DELETE). Blocks future requests with the same token for 48 hours, ensuring
     *        only the first request is processed. Valid values can contain 1-100 alphanumeric and
     *        special characters. See <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/request-tokens" target="_blank">Request Tokens</a>
     *        for more information.
     * @param string|null $token A single-use, limited authentication layer in addition to an API
     *        Key or Session Key to authorize sensitive operations. <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/auth-tokens" target="_blank">Auth Tokens</a> add
     *        security by requiring one-time approval for specific actions.
     *
     * @return AppleDomainsMassEnablementForMerchantList Response from the API call
     *
     * @throws ApiException Thrown if API call fails
     */
    public function postApplePayForMerchantList(
        string $id,
        ApplePayForMerchantListPostRequest $body,
        ?string $requestToken = null,
        ?string $token = null
    ): AppleDomainsMassEnablementForMerchantList {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/entities/{id}/enableApplePayForMerchantList')
            ->auth('apiKey', 'sessionKey', 'txnSessionKey')
            ->parameters(
                TemplateParam::init('id', $id),
                HeaderParam::init('Content-Type', 'application/json'),
                BodyParam::init($body),
                HeaderParam::init('request-token', $requestToken),
                HeaderParam::init('token', $token)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn('400', ErrorType::init('Error', ErrorFourHundredException::class))
            ->type(AppleDomainsMassEnablementForMerchantList::class);

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Unregisters Apple Pay domains for a list of merchants using a JSON request body. For each merchant-
     * domain pair, the system updates the corresponding appleDomains record to reflect the `unregistered`
     * status. Domains not yet unregistered are marked as `unregistering`, and asynchronous processing
     * begins. If unregistration succeeds, the status updates to `unregistered`. If unregistration fails,
     * the status reverts back to `registered`, with an `errorNote` explaining the reason.
     *
     * This endpoint is idempotent, allowing repeated submissions of the same request body without adverse
     * effects. Only failed de-registrations are retried.
     *
     * All domains must be fully qualified domain names (FQDNs) and must have previously been registered
     * for Apple Pay and verified.
     *
     *
     * @param string $id The Payrix Pro Entity ID for the Partner initiating unregistration for one
     *        or more Merchants.
     * @param ApplePayForMerchantListPostRequest $body
     * @param string|null $requestToken A custom, one-time identifier for any API request (GET, PUT,
     *        POST, or DELETE). Blocks future requests with the same token for 48 hours, ensuring
     *        only the first request is processed. Valid values can contain 1-100 alphanumeric and
     *        special characters. See <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/request-tokens" target="_blank">Request Tokens</a>
     *        for more information.
     * @param string|null $token A single-use, limited authentication layer in addition to an API
     *        Key or Session Key to authorize sensitive operations. <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/auth-tokens" target="_blank">Auth Tokens</a> add
     *        security by requiring one-time approval for specific actions.
     *
     * @return AppleDomainsMassEnablementForMerchantList Response from the API call
     *
     * @throws ApiException Thrown if API call fails
     */
    public function postApplePayForMerchantListDisable(
        string $id,
        ApplePayForMerchantListPostRequest $body,
        ?string $requestToken = null,
        ?string $token = null
    ): AppleDomainsMassEnablementForMerchantList {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/entities/{id}/disableApplePayForMerchantList')
            ->auth('apiKey', 'sessionKey', 'txnSessionKey')
            ->parameters(
                TemplateParam::init('id', $id),
                HeaderParam::init('Content-Type', 'application/json'),
                BodyParam::init($body),
                HeaderParam::init('request-token', $requestToken),
                HeaderParam::init('token', $token)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn('400', ErrorType::init('Error', ErrorFourHundredException::class))
            ->type(AppleDomainsMassEnablementForMerchantList::class);

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Verifies a remote Apple Pay configuration file.
     *
     * The configuration file must be stored on the merchant's or vendor's domain, but accessible to the
     * Payrix systems.
     *
     * This endpoint can be used to ensure the configuration file is in the correct location with the
     * correct rights for remote access.
     *
     * It is meant to validate one configuration file with the provided Fully Qualified Domain Name (fqdn).
     *
     * This endpoint does not do any action towards registration. It only verifies access to the remote
     * file.
     *
     *
     * @param string $id The Payrix Pro Merchant ID for the Partner initiating verification for the
     *        listed domain.
     * @param UpdateApplePayDomainPostRequest $body
     * @param string|null $requestToken A custom, one-time identifier for any API request (GET, PUT,
     *        POST, or DELETE). Blocks future requests with the same token for 48 hours, ensuring
     *        only the first request is processed. Valid values can contain 1-100 alphanumeric and
     *        special characters. See <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/request-tokens" target="_blank">Request Tokens</a>
     *        for more information.
     * @param string|null $token A single-use, limited authentication layer in addition to an API
     *        Key or Session Key to authorize sensitive operations. <a href="/apis/payrix/dev-int-
     *        guide/references/authentication/auth-tokens" target="_blank">Auth Tokens</a> add
     *        security by requiring one-time approval for specific actions.
     *
     * @return UpdateApplePayDomainResponseResult Response from the API call
     *
     * @throws ApiException Thrown if API call fails
     */
    public function postUpdateApplePayDomain(
        string $id,
        UpdateApplePayDomainPostRequest $body,
        ?string $requestToken = null,
        ?string $token = null
    ): UpdateApplePayDomainResponseResult {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/merchants/{id}/updateApplePayDomain')
            ->auth('apiKey', 'sessionKey', 'txnSessionKey')
            ->parameters(
                TemplateParam::init('id', $id),
                HeaderParam::init('Content-Type', 'application/json'),
                BodyParam::init($body),
                HeaderParam::init('request-token', $requestToken),
                HeaderParam::init('token', $token)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn('400', ErrorType::init('Error', ErrorFourHundredException::class))
            ->type(UpdateApplePayDomainResponseResult::class);

        return $this->execute($_reqBuilder, $_resHandler);
    }
}
